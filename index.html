<!DOCTYPE html>
<html>
<head>
    <title>NDOT Wallpaper Maker</title>
    <link rel="stylesheet" type="text/css" href="css/ndot_wallpaper_maker.css">
</head>
<body>
    <!-- ヘッダー。中央ぞろえでタイトルを表示-->
    <header>
        <center>
            <h1>NDOT Wallpaper Maker</h1>
        </center>
    </header>
    <!--説明-->
    <div id="description">
        <p><center>手軽にNOTHING風フォントで壁紙が作れます。下の設定から細かい調整を行えます。</center></p>
    </div>
        </center>
    </div>
    <!--設定入力部分-->
    <div id="settings">
        <div class = button>
        <button onclick="toggleSettings()">設定の表示を切り替え</button>
        </div>
        <div id="settingsContent" style="display: none;">
            <!--背景色-->
            <p>背景色
                <input type="color" id="background_color_input" value="#f0f0f0">
            </p>
            <!--テキスト内容（長文、htmlタグ使用可能）-->
            <p>テキスト（htmlタグ使用可能）<br>
            <textarea id="text_input">ここにテキストを入力してください</textarea>
            </p>
            <!--テキストの色-->
            <p>テキストの色
                <input type="color" id="font_color_input" value="#000000">
            </p>
            <!--フォントサイズ-->
            <p>テキストのサイズ
                <input type="number" id="font_size_input" value="20">px
            </p>
            <!--テキストの方向（一つだけボタンで選択）-->
            <p>テキストの方向
                <input type="radio" name="text_direction" value="horizontal" checked>横書き
                <input type="radio" name="text_direction" value="vertical">縦書き
            </p>
            <!--サイズ-->
            <p>サイズ<br>
                <input type="radio" name="size" value="Nothing Phone(1)" checked>Nothing Phone(1)<br>
                <input type="radio" name="size" value="Nothing Phone(2)">Nothing Phone(2)<br>
                <input type="radio" name="size" value="Nothing Phone(2a)">Nothing Phone(2a)<br>
                <input type="radio" name="size" value="custom" onclick="enableCustomSize()">カスタム <input type="number" id="width_input" value="1080">x<input type="number" id="height_input" value="1920">px
            </p>
            <p>余白
                <input type="number" id="margin_input" value="10">px
        </div>
    </div>

    <script>
        function toggleSettings() {
            var settingsContent = document.getElementById("settingsContent");
            if (settingsContent.style.display === "none") {
                settingsContent.style.display = "block";
            } else {
                settingsContent.style.display = "none";
            }
        }
    </script>
    <!--プレビュー部分（Javascriptキャンバス）-->
    <p>
        <center>
            ▼プレビュー（設定を入力すると表示されます）
        </center>
    </p>
    <div id="preview">
        <center>
        <canvas id="preview_canvas"></canvas>
        <script>
            var canvas = document.getElementById("preview_canvas");
            var ctx = canvas.getContext("2d");
            var background_color_input = document.getElementById("background_color_input");
            var text_input = document.getElementById("text_input");
            var font_color_input = document.getElementById("font_color_input");
            var font_size_input = document.getElementById("font_size_input");
            var text_direction = document.getElementsByName("text_direction");
            var width_input = document.getElementById("width_input");
            var height_input = document.getElementById("height_input");
            var margin_input = document.getElementById("margin_input");

            function draw() {
                // キャンバスのサイズを設定
                var selectedSize = document.querySelector('input[name="size"]:checked').value;
                var sizeList = {
                    "Nothing Phone(1)": { width: 100, height: 200 },
                    "Nothing Phone(2)": { width: 300, height: 100 },
                    "Nothing Phone(2a)": { width: 500, height: 100 },
                    "custom": { width: parseInt(width_input.value), height: parseInt(height_input.value) }
                };
                canvas.width = sizeList[selectedSize].width;
                canvas.height = sizeList[selectedSize].height;

                // 背景色を設定
                ctx.fillStyle = background_color_input.value;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // テキストを設定
                var font = new FontFace('Ndot77JPExtended', 'url(https://github.com/shibadogcap/ndot_wallpaper_maker/blob/main/fonts/Ndot77JPExtendedv1.1.4.woff2)');
                font.load().then(function(loadedFont) {
                    document.fonts.add(loadedFont);
                    ctx.font = font_size_input.value + "px 'Ndot77JPExtended'";
                    ctx.fillStyle = font_color_input.value;
                    // テキスト描画を呼び出す前に再帰呼び出しを削除
                    // draw();
                }).catch(function(error) {
                    console.log('Font loading failed: ' + error);
                });
                var text = text_input.value;
                var textWidth = ctx.measureText(text).width;
                var textHeight = parseInt(font_size_input.value);
                var x = (canvas.width - textWidth) / 2;
                var y = (canvas.height + textHeight) / 2;
                if (text_direction[1].checked) {
                    ctx.save();
                    ctx.translate(canvas.width / 2, canvas.height / 2);
                    ctx.rotate(-Math.PI / 2);
                    ctx.textAlign = "center";
                    ctx.fillText(text, 0, 0);
                    ctx.restore();
                } else {
                    ctx.textAlign = "center";
                    ctx.fillText(text, x, y);
                }
            }

            // 設定が変更されたらプレビューを更新
            var inputs = document.querySelectorAll("input");
            for (var i = 0; i < inputs.length; i++) {
                inputs[i].addEventListener("input", draw);
            }
            var textareas = document.querySelectorAll("textarea");
            for (var i = 0; i < textareas.length; i++) {
                textareas[i].addEventListener("input", draw);
            }
            var radios = document.querySelectorAll("input[type=radio]");
            for (var i = 0; i < radios.length; i++) {
                radios[i].addEventListener("change", draw);
            }
            draw();

            //設定が変更されたらプレビューを更新
            var inputs = document.querySelectorAll("input");
            for (var i = 0; i < inputs.length; i++) {
                inputs[i].addEventListener("input", draw);
            }
            var textareas = document.querySelectorAll("textarea");
            for (var i = 0; i < textareas.length; i++) {
                textareas[i].addEventListener("input", draw);
            }
            var radios = document.querySelectorAll("input[type=radio]");
            for (var i = 0; i < radios.length; i++) {
                radios[i].addEventListener("change", draw);
            }
            draw();
        </script>
</body>
</html>